<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayurvedic Home Remedies Finder</title>
    <style>
        :root {
            --primary-color: #2c6e49;
            --secondary-color: #4c956c;
            --accent-color: #fefee3;
            --light-color: #f9f9f9;
            --dark-color: #1d3557;
            --warning-color: #d62828;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Updated Header with Logo and Navigation */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            font-size: 2rem;
            margin-right: 10px;
        }
        
        .back-to-home {
            color: white;
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .back-to-home:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .header-content {
            text-align: center;
            flex-grow: 1;
        }
        
        .header-content h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .input-section {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .input-section h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 1rem;
            resize: vertical;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
            background-color: var(--light-color);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-connected {
            background-color: #4caf50;
        }
        
        .status-disconnected {
            background-color: var(--warning-color);
        }
        
        /* Image Analysis Styles */
        .image-analysis-section {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .upload-container {
            margin: 1.5rem 0;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(44, 110, 73, 0.05);
        }

        .upload-placeholder {
            color: #666;
        }

        .upload-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 1rem;
        }

        .upload-subtext {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.5rem;
        }

        .upload-preview {
            text-align: center;
            margin-top: 1.5rem;
        }

        #preview-image {
            max-width: 300px;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .analyze-btn, .cancel-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0 0.5rem;
        }

        .analyze-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .cancel-btn {
            background-color: #f1f1f1;
            color: #333;
        }

        .analysis-results {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .condition-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .condition-card h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .remedy-list {
            list-style-type: none;
            padding-left: 0;
        }

        .remedy-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .remedy-list li:last-child {
            border-bottom: none;
        }

        .analysis-loading {
            text-align: center;
            padding: 2rem;
        }

        .analysis-error {
            background-color: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
        }
        
        .results-section {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .results-section h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .remedy-card {
            background-color: var(--light-color);
            border-left: 4px solid var(--secondary-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .remedy-card h3 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .ai-advice {
            background-color: #e9f5ff;
            border-left: 4px solid #1d3557;
            padding: 1.5rem;
            margin-top: 2rem;
            border-radius: 4px;
        }
        
        .source-info {
            font-size: 0.9rem;
            color: #666;
            margin-top: 1rem;
            font-style: italic;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 1.5rem;
            color: #666;
            background-color: #f1f1f1;
            border-radius: 8px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
                padding: 1rem;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .header-content h1 {
                font-size: 1.8rem;
            }
            
            .input-section, .results-section, .image-analysis-section {
                padding: 1.5rem;
            }
            
            .back-to-home {
                margin-top: 1rem;
            }
            
            #preview-image {
                max-width: 100%;
            }
            
            .analyze-btn, .cancel-btn {
                margin: 0.5rem 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Updated Header with Logo and Navigation -->
        <header class="main-header">
            <div class="logo-container">
                <div class="logo">
                    <span class="logo-icon">üåø</span>
                    Ayurvedic Remedies
                </div>
            </div>
            
            <div class="header-content">
                <h1>Ayurvedic Home Remedies Finder</h1>
                <p class="subtitle">Describe your symptoms and discover natural Ayurvedic remedies</p>
            </div>
            
            <a href="index.html" class="back-to-home">
                <span>‚Üê</span> Back to Home
            </a>
        </header>
        
        <main class="main-content">
            <!-- Text Input Section -->
            <section class="input-section">
                <h2>Describe Your Symptoms</h2>
                <p>Explain what you're experiencing (e.g., cough, cold, fever, stomach ache, etc.)</p>
                <textarea id="symptoms-input" placeholder="I've been having a dry cough for three days with chest congestion and slight headache..."></textarea>
                <button id="find-remedies">Find Ayurvedic Remedies</button>
                
                <div class="api-status" id="api-status">
                    <div class="status-indicator status-disconnected" id="status-indicator"></div>
                    <span id="status-text">Checking API connection...</span>
                </div>
            </section>
            
            <!-- Image Analysis Section -->
            <section class="image-analysis-section">
                <h2>Analyze Skin Conditions with AI</h2>
                <p>Upload an image of skin problem or visible symptom for AI analysis</p>
                
                <div class="upload-container">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-placeholder">
                            <span class="upload-icon">üì∑</span>
                            <p>Drag & drop image here or click to browse</p>
                            <p class="upload-subtext">Supports JPG, PNG up to 5MB</p>
                        </div>
                        <input type="file" id="image-upload" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="upload-preview" id="image-preview" style="display: none;">
                        <img id="preview-image" src="#" alt="Preview">
                        <button id="analyze-button" class="analyze-btn">Analyze Image</button>
                        <button id="cancel-upload" class="cancel-btn">Cancel</button>
                    </div>
                </div>
                
                <div class="analysis-results" id="analysis-results" style="display: none;">
                    <h3>Analysis Results</h3>
                    <div id="analysis-content"></div>
                </div>
            </section>
            
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Analyzing your symptoms and finding the best Ayurvedic remedies...</p>
            </div>
            
            <section class="results-section" id="results-section">
                <h2>Recommended Ayurvedic Remedies</h2>
                <div id="remedies-container"></div>
                
                <div class="ai-advice" id="ai-advice" style="display: none;">
                    <h3>Personalized Ayurvedic Advice</h3>
                    <div id="enhanced-advice"></div>
                    <p class="source-info" id="advice-source"></p>
                </div>
            </section>
        </main>
        
        <footer>
            <p><strong>Important Note:</strong> This tool provides traditional home remedies for informational purposes only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult with a qualified healthcare professional for serious medical conditions.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const symptomsInput = document.getElementById('symptoms-input');
            const findRemediesBtn = document.getElementById('find-remedies');
            const loadingElement = document.getElementById('loading');
            const resultsSection = document.getElementById('results-section');
            const remediesContainer = document.getElementById('remedies-container');
            const aiAdviceSection = document.getElementById('ai-advice');
            const enhancedAdvice = document.getElementById('enhanced-advice');
            const adviceSource = document.getElementById('advice-source');
            const apiStatus = document.getElementById('api-status');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            // Image Analysis Elements
            const uploadArea = document.getElementById('upload-area');
            const imageUpload = document.getElementById('image-upload');
            const imagePreview = document.getElementById('image-preview');
            const previewImage = document.getElementById('preview-image');
            const analyzeButton = document.getElementById('analyze-button');
            const cancelUpload = document.getElementById('cancel-upload');
            const analysisResults = document.getElementById('analysis-results');
            const analysisContent = document.getElementById('analysis-content');
            
            const API_BASE_URL = 'https://ayurvedic-remedies-website-backend.onrender.com';
            
            let uploadedImage = null;
            
            // Check API status on page load
            checkApiStatus();
            
            // Ayurvedic knowledge base (fallback if API is unavailable)
            const ayurvedicKnowledge = [
                {
                    symptoms: ["cough", "cold", "congestion"],
                    remedy: "Ginger and Tulsi Tea",
                    description: "Boil fresh ginger slices and tulsi (holy basil) leaves in water for 5-7 minutes. Add a teaspoon of honey and drink warm. This helps relieve cough and cold symptoms.",
                    ingredients: ["Fresh ginger", "Tulsi leaves", "Honey", "Water"],
                    dosage: "Drink 2-3 times daily until symptoms improve"
                },
                {
                    symptoms: ["fever", "body ache"],
                    remedy: "Turmeric Milk",
                    description: "Heat a cup of milk with a teaspoon of turmeric powder. Drink warm before bedtime. Turmeric has anti-inflammatory properties that can help reduce fever and body aches.",
                    ingredients: ["Milk", "Turmeric powder"],
                    dosage: "Drink once daily at bedtime during illness"
                }
            ];
            
            // Check if API is available
            async function checkApiStatus() {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/health`);
                    if (response.ok) {
                        statusIndicator.classList.remove('status-disconnected');
                        statusIndicator.classList.add('status-connected');
                        statusText.textContent = 'API connected successfully';
                    } else {
                        throw new Error('API not responding');
                    }
                } catch (error) {
                    console.error('API connection failed:', error);
                    statusIndicator.classList.remove('status-connected');
                    statusIndicator.classList.add('status-disconnected');
                    statusText.textContent = 'API unavailable - using local knowledge base only';
                }
            }
            
            findRemediesBtn.addEventListener('click', async function() {
                const symptomsText = symptomsInput.value.trim();
                
                if (!symptomsText) {
                    alert('Please describe your symptoms first.');
                    return;
                }
                
                // Show loading state
                loadingElement.style.display = 'block';
                resultsSection.style.display = 'none';
                aiAdviceSection.style.display = 'none';
                findRemediesBtn.disabled = true;
                
                try {
                    // Try to get remedies from API
                    const response = await fetch(`${API_BASE_URL}/api/remedies`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ symptoms: symptomsText })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        displayResults(data);
                    } else {
                        throw new Error('API request failed');
                    }
                } catch (error) {
                    console.error('API error, using fallback:', error);
                    // Fallback to local matching if API fails
                    const matchedRemedies = findMatchingRemedies(symptomsText.toLowerCase());
                    displayResults({
                        remedies: matchedRemedies,
                        enhancedAdvice: null,
                        source: "Local Ayurvedic knowledge base (API unavailable)"
                    });
                } finally {
                    // Hide loading, show results
                    loadingElement.style.display = 'none';
                    resultsSection.style.display = 'block';
                    findRemediesBtn.disabled = false;
                }
            });
            
            // Image Analysis functionality
            
            // Click on upload area triggers file input
            uploadArea.addEventListener('click', function() {
                imageUpload.click();
            });
            
            // Drag and drop functionality
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = '#2c6e49';
                uploadArea.style.backgroundColor = 'rgba(44, 110, 73, 0.1)';
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = 'transparent';
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length) {
                    handleImageFile(e.dataTransfer.files[0]);
                }
            });
            
            // File input change handler
            imageUpload.addEventListener('change', function(e) {
                if (e.target.files.length) {
                    handleImageFile(e.target.files[0]);
                }
            });
            
            // Handle the selected image file
            function handleImageFile(file) {
                if (!file.type.match('image.*')) {
                    alert('Please select an image file');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    alert('Please select an image smaller than 5MB');
                    return;
                }
                
                uploadedImage = file;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    uploadArea.style.display = 'none';
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
            
            // Cancel upload
            cancelUpload.addEventListener('click', function() {
                resetImageUpload();
            });
            
            // Analyze image
            analyzeButton.addEventListener('click', function() {
                if (!uploadedImage) return;
                
                analyzeButton.disabled = true;
                analyzeButton.textContent = 'Analyzing...';
                analysisResults.style.display = 'block';
                analysisContent.innerHTML = `
                    <div class="analysis-loading">
                        <div class="loading-spinner"></div>
                        <p>AI is analyzing your image...</p>
                    </div>
                `;
                
                analyzeImage(uploadedImage);
            }
            
            // Reset upload interface
            function resetImageUpload() {
                uploadedImage = null;
                imageUpload.value = '';
                uploadArea.style.display = 'block';
                imagePreview.style.display = 'none';
                analysisResults.style.display = 'none';
            }
            
            // Send image to backend for analysis
            async function analyzeImage(imageFile) {
                const formData = new FormData();
                formData.append('image', imageFile);
                
                try {
                    const response = await fetch(`${API_BASE_URL}/api/analyze-image`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        displayAnalysisResults(data);
                    } else {
                        throw new Error('Image analysis failed');
                    }
                } catch (error) {
                    console.error('Analysis error:', error);
                    analysisContent.innerHTML = `
                        <div class="analysis-error">
                            <p>Analysis failed. Please try again or describe your symptoms in text.</p>
                        </div>
                    `;
                } finally {
                    analyzeButton.disabled = false;
                    analyzeButton.textContent = 'Analyze Image';
                }
            }
            
            // Display analysis results
            function displayAnalysisResults(data) {
                let remediesHtml = '';
                
                if (data.remedies && data.remedies.length) {
                    remediesHtml = `
                        <h4>Suggested Ayurvedic Remedies:</h4>
                        <ul class="remedy-list">
                            ${data.remedies.map(remedy => `
                                <li>
                                    <strong>${remedy.remedy}:</strong> ${remedy.description}
                                    ${remedy.ingredients.length ? `<br><em>Ingredients: ${remedy.ingredients.join(', ')}</em>` : ''}
                                    ${remedy.dosage ? `<br><em>Dosage: ${remedy.dosage}</em>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    `;
                }
                
                analysisContent.innerHTML = `
                    <div class="condition-card">
                        <h4>Condition: ${data.condition}</h4>
                        <p>${data.advice || 'Based on AI analysis, here are some traditional Ayurvedic approaches:'}</p>
                        ${remediesHtml}
                    </div>
                    <p class="source-info">${data.note || 'Note: This analysis is based on AI interpretation and should not replace professional medical diagnosis.'}</p>
                `;
            }
            
            function findMatchingRemedies(symptomsText) {
                const matches = [];
                
                // Check each remedy for matching symptoms
                for (const remedy of ayurvedicKnowledge) {
                    for (const symptom of remedy.symptoms) {
                        if (symptomsText.includes(symptom.toLowerCase())) {
                            matches.push(remedy);
                            break;
                        }
                    }
                }
                
                // If no direct matches, return some general remedies
                if (matches.length === 0) {
                    return [
                        {
                            remedy: "General Ayurvedic Health Tips",
                            description: "For overall health, Ayurveda recommends: 1) Drinking warm water throughout the day, 2) Eating meals at regular times, 3) Including all six tastes (sweet, sour, salty, bitter, pungent, astringent) in your diet, 4) Practicing daily meditation and yoga, 5) Getting adequate sleep.",
                            ingredients: ["Balanced diet", "Regular routine", "Adequate hydration"],
                            dosage: "Practice daily for overall wellness"
                        }
                    ];
                }
                
                return matches;
            }
            
            function displayResults(data) {
                remediesContainer.innerHTML = '';
                enhancedAdvice.innerHTML = '';
                adviceSource.textContent = '';
                
                if (data.remedies && data.remedies.length > 0) {
                    data.remedies.forEach(remedy => {
                        const remedyCard = document.createElement('div');
                        remedyCard.className = 'remedy-card';
                        
                        let ingredientsHtml = '';
                        if (remedy.ingredients) {
                            ingredientsHtml = `<p><strong>Ingredients:</strong> ${remedy.ingredients.join(', ')}</p>`;
                        }
                        
                        let dosageHtml = '';
                        if (remedy.dosage) {
                            dosageHtml = `<p><strong>Dosage:</strong> ${remedy.dosage}</p>`;
                        }
                        
                        remedyCard.innerHTML = `
                            <h3>${remedy.remedy}</h3>
                            <p>${remedy.description}</p>
                            ${ingredientsHtml}
                            ${dosageHtml}
                        `;
                        
                        remediesContainer.appendChild(remedyCard);
                    });
                } else {
                    remediesContainer.innerHTML = '<p>No specific remedies found for your symptoms.</p>';
                }
                
                if (data.enhancedAdvice) {
                    enhancedAdvice.innerHTML = `<p>${data.enhancedAdvice}</p>`;
                    adviceSource.textContent = `Source: ${data.source}`;
                    aiAdviceSection.style.display = 'block';
                } else if (data.source) {
                    adviceSource.textContent = `Source: ${data.source}`;
                }
            }
        });
    </script>
</body>
</html>
